<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Predictelligence Property ‚Äî UK Property Intelligence Platform</title>
  <meta name="description" content="AI-powered UK property valuation, risk analysis and live ML price forecasting in one unified platform." />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%2300e5a0'/><text y='24' x='5' font-size='22' font-weight='900' fill='%2307090f'>P</text></svg>" />
</head>
<body>

  <!-- Ambient background orbs -->
  <div class="bg-canvas" aria-hidden="true">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>

  <div class="wrap content">

    <!-- ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ -->
    <nav>
      <div class="nav-brand">
        <div class="nav-logo-mark">P</div>
        <div class="nav-title">Predictelligence <span>Property</span></div>
      </div>
      <div class="nav-links">
        <span class="nav-pill">UK Market</span>
        <span class="nav-pill">ML Powered</span>
        <a class="btn-ghost" href="/api/prediction/health">Engine Status</a>
      </div>
    </nav>

    <!-- ‚îÄ‚îÄ Hero ‚îÄ‚îÄ -->
    <section class="hero">
      <div class="hero-eyebrow">
        <span class="live-dot"></span>
        Live ML Forecasting Active
      </div>
      <h1 class="hero-title">
        UK Property Intelligence<br />
        <span class="grad-text">Powered by Live Data</span>
      </h1>
      <p class="hero-sub">
        Paste any Rightmove listing to get an AI-powered scorecard, comparable analysis,
        negotiation strategy, and a live machine-learning price forecast ‚Äî all in one.
      </p>
    </section>

    <!-- ‚îÄ‚îÄ Analysis form ‚îÄ‚îÄ -->
    <div class="form-card" style="margin-bottom: 28px;">
      <div class="card-header">
        <span class="card-title">Analyse a Property</span>
        <div style="display:flex;gap:6px;">
          <span class="badge badge-green">AI Scorecard</span>
          <span class="badge badge-purple">ML Forecast</span>
        </div>
      </div>

      <form id="analyze-form">
        <div class="form-row">
          <div class="input-wrap">
            <span class="input-icon">üîó</span>
            <input
              id="url-input"
              type="url"
              placeholder="Paste a Rightmove listing URL‚Ä¶"
              autocomplete="off"
              spellcheck="false"
            />
          </div>
          <div class="select-wrap">
            <select id="user-type">
              <option value="investor">üìà Property Investor</option>
              <option value="first_time_buyer">üè† First-Time Buyer</option>
              <option value="home_mover">üîë Home Mover</option>
            </select>
          </div>
          <button id="submit-btn" class="btn-primary" type="submit">Analyse</button>
        </div>
      </form>

      <div class="loading-msg" id="loading-msg">
        <div class="spinner"></div>
        Running PropertyScorecard + Predictelligence forecast‚Ä¶
      </div>
      <div class="error-banner" id="error-msg"></div>

      <p class="form-hint">
        ‚ö†Ô∏è Rightmove blocks some datacenter IPs. If scraping fails, the Predictelligence forecast still runs via the standalone API below.
      </p>
    </div>

    <!-- ‚îÄ‚îÄ Dynamic results rendered by app.js ‚îÄ‚îÄ -->
    <div id="result-area"></div>

    <!-- ‚îÄ‚îÄ Recent analyses ‚îÄ‚îÄ -->
    <section class="history-section">
      <div class="history-header">
        <span class="history-title">Recent Analyses</span>
        {% if analyses %}
        <span class="badge badge-ghost">{{ analyses|length }}</span>
        {% endif %}
      </div>

      {% if analyses %}
      <div class="card" style="padding:0; overflow:hidden;">
        <table>
          <thead>
            <tr>
              <th>When</th>
              <th>Property</th>
              <th>Score</th>
              <th>Verdict</th>
              <th>Fair Value (mid)</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for a in analyses %}
            <tr>
              <td style="color:var(--muted); white-space:nowrap;">
                {{ a.created_at_utc[:16].replace("T"," ") if a.created_at_utc else "‚Äî" }}
              </td>
              <td style="color:var(--muted); font-size:12px; max-width:180px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                {{ a.property_id or a.url[:40] or "‚Äî" }}
              </td>
              <td>
                {% if a.valuation %}
                  {% set s = a.valuation.score|int %}
                  <span class="badge {% if s >= 70 %}badge-green{% elif s >= 45 %}badge-amber{% else %}badge-red{% endif %}">
                    {{ s }}/100
                  </span>
                {% else %}‚Äî{% endif %}
              </td>
              <td style="font-size:12px; color:var(--muted); max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                {{ a.valuation.label[:40] if a.valuation and a.valuation.label else "‚Äî" }}
              </td>
              <td style="font-weight:600;">
                {% if a.valuation and a.valuation.fair_value_mid %}
                  ¬£{{ "{:,}".format(a.valuation.fair_value_mid|int) }}
                {% else %}‚Äî{% endif %}
              </td>
              <td style="text-align:right;">
                <a class="btn-ghost" href="/a/{{ a.id }}">View ‚Üí</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty-state">
        <div class="empty-icon">üè°</div>
        <p class="empty-state-msg">No analyses yet. Paste a Rightmove URL above to get started.</p>
      </div>
      {% endif %}
    </section>

    <!-- ‚îÄ‚îÄ Standalone API bar ‚îÄ‚îÄ -->
    <div class="api-row">
      <span class="api-row-label">Predictelligence Standalone API ‚Üí</span>
      <a class="btn-ghost" href="/api/prediction/predict?postcode=SW1A1AA&current_valuation=450000&user_type=investor">Try Predict API</a>
      <a class="btn-ghost" href="/api/prediction/history?postcode=SW1A1AA">History</a>
      <a class="btn-ghost" href="/api/prediction/health">Health Check</a>
    </div>

    <p class="footer-text">
      Predictelligence Property ‚Äî Educational purposes only. Not financial advice or a professional valuation.
    </p>

  </div><!-- .wrap -->

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
